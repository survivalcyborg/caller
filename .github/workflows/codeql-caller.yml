name: CodeQL-Caller

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop
  schedule:
    - cron: '0 20 25 * *'

jobs:
  set_parameters:
    runs-on: ubuntu-latest
    outputs:
      languages: ${{ steps.set_languages.outputs.languages }}
      build_modes: ${{ steps.set_build_modes.outputs.build_modes }}

    steps:
      - name: Set Languages
        id: set_languages
        run: |
          echo "::set-output name=languages::java,python"
      
      - name: Set Build Modes
        id: set_build_modes
        run: |
          echo "::set-output name=build_modes::autobuild,none"

  dispatch_codeql:
    needs: set_parameters
    runs-on: ubuntu-latest
    steps:
      - name: Dispatch CodeQL Workflow
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.CODEQL }}
          repository: survivalcyborg/ghas
          event-type: run-codeql
          client-payload: |
            {
              "languages": "${{ needs.set_parameters.outputs.languages }}",
              "build_modes": "${{ needs.set_parameters.outputs.build_modes }}"
            }
